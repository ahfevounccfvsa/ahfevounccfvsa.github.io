<!DOCTYPE html>
<html lang=zh-Hans>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="null">
  <meta name="keywords" content="undefined">
  
    <link rel="icon" href="/favicon.ico">
  
    
  <title>Jenkins自动集成小记 | cmlanche</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/lib/jquery.fancybox.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>cmlanche</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>Jenkins自动集成小记</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2017/08/10</time>
            
            
              | 
                  <i class="fa fa-tag" aria-hidden="true"></i>
                
               
  <a href="/tags/#jenkins" class='tag'>jenkins</a>


            
          </div>
          <p>Jenkins是用来自动构建任务的，也许你还不知道什么叫自动构建任务，它的意思是可以针对某个任务进行自动化，比如你开发的某个软件，每次写完代码提交到<code>github</code>之后，你可以设置让Jenkins自动进行打包构建发布包或者进行Units测试，发布报告，不用你每次手工在<code>IDE</code>中去Build，尤其是当打包非常繁琐的时候，用自动化构建可以极大的提高工作效率。</p>
<a id="more"></a>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>公司是同事使用<code>Jenkins</code>做的自动化构建，非常方便，每次提交代码，自动检测打包是否成功，然后发送邮件通知，因为我们集成了<code>findingbugs</code>插件，在打包前还会对代码进行<code>findingbus</code>检索，告诉你<code>findingbus</code>的状态，还会生成release的发布包，非常之方便。</p>
<p><code>wement.io</code>这个项目我想多人协作开发，自然想到了Jenkins，让大家能够配合的非常的舒服，昨天折腾了三小时，搞定了<code>Jenkins</code>，其中包括怎么创建一个任务，怎么设置<code>github</code>，和<code>github</code>的项目挂钩，怎么设置邮件通知。</p>
<h3 id="安装Jenkins"><a href="#安装Jenkins" class="headerlink" title="安装Jenkins"></a>安装<code>Jenkins</code></h3><p>直接去<code>Jenkins</code>官网下载<code>war</code>包，我这里是直接部署在阿里云的centos7上的，然后用<code>scp xxx.war root@yourip:/home</code>直接从本地拷贝到云服务器上，拷贝之后直接用<code>java -jar xxx.war</code>就可以运行成功了，如果你期望退出命令行还不关闭<code>Jenkins</code>的话，就用命令<code>nohug java -jar xxx.war</code>(centos 用nohup)来运行包，java进程自动在后台运行了，关闭命令行窗口也不会退出程序，这样你的<code>Jenkins</code>就运行了，默认端口监听在8080，如果你也是用的云服务器，请确保你的8080端口是允许访问的。</p>
<p>当然，要运行<code>Jenkins</code>，你需要安装Java环境，如果你的代码仓库用<code>git</code>的话请安装git，分别命令如下：</p>
<p><code>yum install java</code></p>
<p><code>yum install git</code></p>
<p>还没有完，Jenkins运行成功了，你再在浏览器上打开<code>yourip:8080</code>跟随<code>Jenkins</code>安装向导，用默认提示安装完成即可，接下来就是创建任务了。</p>
<h3 id="创建一个任务"><a href="#创建一个任务" class="headerlink" title="创建一个任务"></a>创建一个任务</h3><p><img src="http://onrd7xdyg.bkt.clouddn.com/QQ20170810-225528@2x.png" alt=""></p>
<p>选择第一性，<code>构建一个自由风格的软件项目</code></p>
<p><img src="http://onrd7xdyg.bkt.clouddn.com/QQ20170810-225926@2x.png" alt=""></p>
<p><img src="http://onrd7xdyg.bkt.clouddn.com/QQ20170810-230126@2x.png" alt=""></p>
<p><img src="http://onrd7xdyg.bkt.clouddn.com/QQ20170810-230041@2x.png" alt=""></p>
<p><img src="http://onrd7xdyg.bkt.clouddn.com/3ECD3136-0E4B-4507-BD7C-90CDA2883D17.png" alt=""></p>
<p><img src="http://onrd7xdyg.bkt.clouddn.com/QQ20170810-230230@2x.png" alt=""></p>
<p><img src="http://onrd7xdyg.bkt.clouddn.com/QQ20170810-230641@2x.png" alt=""></p>
<p>然后保存即可，任务创建完成。但是如果你的项目是私有项目，你需要在你的服务器上生成ssh，然后贴到你的github上，这样做的目的是然github信任你的这个服务器，同时要注意你的Jenkins控制台，有可能要你输入ssh的证书密码。</p>
<h3 id="邮件通知"><a href="#邮件通知" class="headerlink" title="邮件通知"></a>邮件通知</h3><p>一般来说这个时候右键通知是没问题的，但是我今天发现我提交代码之后，任务并没有自动构建，然后看<code>Jenkins</code>打的log是这样的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">55</span> [WARNING] mvn dependency:tree -Ddetail=<span class="keyword">true</span> and the above output.</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">55</span> [WARNING] See http:<span class="comment">//maven.apache.org/plugins/maven-shade-plugin/</span></div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> [INFO] ------------------------------------------------------------------------</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> [INFO] BUILD SUCCESS</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> [INFO] ------------------------------------------------------------------------</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> [INFO] Total time: <span class="number">10.112</span>s</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> [INFO] Finished at: Thu Aug <span class="number">10</span> <span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> CST <span class="number">2017</span></div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> [INFO] Final Memory: <span class="number">20</span>M/<span class="number">59</span>M</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> [INFO] ------------------------------------------------------------------------</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> Archiving artifacts</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> Email was triggered <span class="keyword">for</span>: Always</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> Sending email <span class="keyword">for</span> trigger: Always</div><div class="line"><span class="number">22</span>:<span class="number">23</span>:<span class="number">56</span> Not sending mail to unregistered user chengming<span class="meta">@testin</span>.cn because your SCM claimed <span class="keyword">this</span> was associated with a user ID ‘chengming<span class="string">' which your security realm does not recognize; you may need changes in your SCM plugin</span></div><div class="line"><span class="string">22:23:56 An attempt to send an e-mail to empty list of recipients, ignored.</span></div><div class="line"><span class="string">22:23:56 Finished: SUCCESS</span></div></pre></td></tr></table></figure>
<p>意思是构建成功了，但是发送邮件发现提交代码的用户名是<code>chengming</code>而不是我在<code>Jenkins</code>中设置的<code>cmlanche</code>，然后Jenkins自动忽略了发送邮件的这个行为。</p>
<p>然后我在我的<code>sourcetree</code>中把提交代码的用户换回了<code>cmlanche</code>，任务自动构建，邮件发送成功！</p>
<h3 id="Jenkins分享（一）小结"><a href="#Jenkins分享（一）小结" class="headerlink" title="Jenkins分享（一）小结"></a>Jenkins分享（一）小结</h3><p><code>Jenkins</code>是一个非常方便的工具，免费开源，推荐大家都来学习，都折腾下，对你以后大有好处。我其实也是刚刚学这个，知道的还不多，还需要花很多时间去折腾，有更新的收获我会慢慢分享出来。</p>
<p>欢迎加入我的<code>Java栈群</code>：518914410，讨论有关Java的一切技术。</p>
<p>参考另一个小菜的文章：<a href="http://www.jianshu.com/p/b2ed4d23a3a9" target="_blank" rel="external">Jenkins+Github持续集成</a></p>

        </section>
    </article>
    
        <!-- disqus 评论框 start -->
        <div class="comment">
            <div id="disqus_thread" class="disqus-thread">
              <i>Loading comments box needs to over the wall</i>
            </div>
        </div>
        <!-- disqus 评论框 end -->
    
    
        <!-- livere 评论框 start -->
        <div class="comment">
            <div id="lv-container" data-id="city" data-uid="your_livere_uid"></div>
        </div>
        <!-- livere 评论框 end -->
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>目录</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Jenkins"><span class="toc-number">2.</span> <span class="toc-text">安装Jenkins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建一个任务"><span class="toc-number">3.</span> <span class="toc-text">创建一个任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#邮件通知"><span class="toc-number">4.</span> <span class="toc-text">邮件通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jenkins分享（一）小结"><span class="toc-number">5.</span> <span class="toc-text">Jenkins分享（一）小结</span></a></li></ol>
        </div>
    </div>
    
  </aside>
</main>

<!-- disqus 公共JS代码 -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES * * */
  var disqus_shortname = "your_disqus_shortname";
  var disqus_identifier = "http://www.cmlanche.com/2017/08/10/Jenkins自动集成小记(一)/";
  var disqus_url = "http://www.cmlanche.com/2017/08/10/Jenkins自动集成小记(一)/";

  isAgent(getDisqus)

  // determine user agent in China
  function isAgent(cb) {
    var url = '//graph.facebook.com/feed?callback=h';
    var xhr = new XMLHttpRequest();
    var called = false;
    xhr.open('GET', url);
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4 && xhr.status === 200) {
      called = true;
      cb(true);
      }
    };
    xhr.send();
    // timeout 1s, this facebook API is very fast.
    setTimeout(function() {
      if (!called) {
      xhr.abort();
      cb(false)
      }
    }, 1000);
  }

  function getDisqus(isAgent) {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; 
    dsq.async = true
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq)
  }
</script>
<!-- disqus 公共JS代码 end -->


<script type="text/javascript">
  (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];

      if (typeof LivereTower === 'function') { return; }

      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;

      e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>


  <footer>
  <div class="copyright">
    <div>
      &copy; 2018 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="/lib/jquery.fancybox.min.js"></script>


</body>
</html>
